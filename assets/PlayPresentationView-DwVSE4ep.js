import{m as q,r as u,n as h,j as K,p as U,q as D,c as a,b as p,a as c,t as x,s as v,F as G,k as Q,h as k,i as X,o as l,x as Y,y as Z}from"./index-CasKUKGy.js";import{p as I,h as ee}from"./api-C8GlLnQi.js";import{u as te,m as oe}from"./useSlideScale-DHmgTraR.js";const ne={key:0,class:"error-message"},ie={key:1,class:"loading"},se={key:1,class:"slide-loading"},ae={key:2,class:"slide-elements"},le=["innerHTML"],re={key:1,class:"image-container",style:{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center",overflow:"hidden"}},de=["src","alt"],ce={class:"navigation-controls"},ue=["disabled"],_e={class:"slide-counter"},pe=["disabled"],ye={__name:"PlayPresentationView",setup(ge){const M=n=>oe(n.content||""),O=q(),T=X(),y=O.params.id,r=u([]),d=u(0),g=u(""),m=u(!0),_=u({}),f=u({}),V=u(null);te();const s=h(()=>r.value[d.value]||null),w=h(()=>d.value===0),F=h(()=>d.value===r.value.length-1),W=h(()=>s.value?f.value[s.value.slide_id]===!0:!1),H=async n=>{try{console.log("Fetching elements for slide:",n),f.value[n]=!1;const i=await I.getSlideElements(n);if(console.log("Raw elements response for slide",n,":",i),i.success&&i.elements){const o=i.elements.map(e=>{var t,C,L,j,P,R,A,$,N,B;return console.log("Processing element:",e),e.element_type==="image"?{element_id:e.element_id,element_type:"image",x_position:parseFloat(e.x_position),y_position:parseFloat(e.y_position),width:parseFloat(e.width),height:parseFloat(e.height),z_index:e.z_index||0,image_url:((t=e.element_data)==null?void 0:t.image_url)||"",alt_text:((C=e.element_data)==null?void 0:C.alt_text)||""}:{element_id:e.element_id,element_type:e.element_type,x_position:parseFloat(e.x_position),y_position:parseFloat(e.y_position),width:parseFloat(e.width),height:parseFloat(e.height),z_index:e.z_index||0,content:((L=e.element_data)==null?void 0:L.content)||"Empty Text",font_family:((j=e.element_data)==null?void 0:j.font_family)||"Arial",font_size:((P=e.element_data)==null?void 0:P.font_size)||24,font_color:((R=e.element_data)==null?void 0:R.font_color)||"#000000",bold:((A=e.element_data)==null?void 0:A.bold)||!1,italic:(($=e.element_data)==null?void 0:$.italic)||!1,underline:((N=e.element_data)==null?void 0:N.underline)||!1,text_align:((B=e.element_data)==null?void 0:B.text_align)||"left"}});_.value[n]=o,console.log("Final processed elements for slide",n,":",o)}f.value[n]=!0}catch(i){console.error("Error fetching slide elements:",i),f.value[n]=!1}},J=async()=>{var n;try{m.value=!0,g.value="",console.log("Fetching presentation with ID:",y);const i=await I.getPresentation(y);if(console.log("Full presentation response:",JSON.stringify(i,null,2)),i.error)throw new Error(i.error);if(!i.success||!((n=i.presentation)!=null&&n.slides))throw new Error("Failed to fetch presentation slides");if(console.log("Raw slides data:",JSON.stringify(i.presentation.slides,null,2)),r.value=i.presentation.slides.filter(o=>{const e=o&&typeof o=="object"&&o.slide_id&&o.slide_number;return e||console.warn("Invalid slide found:",o),e}).sort((o,e)=>o.slide_number-e.slide_number),console.log("Processed slides with details:",r.value.map(o=>({id:o.slide_id,number:o.slide_number,title:o.title}))),r.value.length===0)throw new Error("No slides found in this presentation");d.value=r.value.findIndex(o=>o.slide_number===1),d.value===-1&&(console.warn("Slide number 1 not found, using first slide"),d.value=0),console.log("Fetching elements for slides:",r.value.map(o=>o.slide_id)),await Promise.all(r.value.map(o=>H(o.slide_id))),console.log("All slide elements:",Object.fromEntries(Object.entries(_.value).map(([o,e])=>[o,e.map(t=>({id:t.element_id,type:t.element_type,content:t.content}))])))}catch(i){console.error("Error in fetchSlides:",i),g.value=ee(i)}finally{m.value=!1}},b=()=>{F.value||d.value++},S=()=>{w.value||d.value--},z=()=>{T.push(`/presentations/${y}`)},E=n=>{switch(n.key){case"ArrowRight":case" ":b();break;case"ArrowLeft":S();break;case"Escape":z();break}};return K(()=>{J(),window.addEventListener("keydown",E)}),U(()=>{window.removeEventListener("keydown",E)}),D(s,()=>Z(()=>{})),D(s,n=>{var i;n&&console.log("Current slide changed to:",{id:n.slide_id,number:n.slide_number,elements:((i=_.value[n.slide_id])==null?void 0:i.length)||0})}),(n,i)=>{var o,e;return l(),a("div",{class:"play-presentation-container",onClick:b},[g.value?(l(),a("div",ne,x(g.value),1)):p("",!0),m.value?(l(),a("div",ie," Loading presentation... ")):s.value?(l(),a("div",{key:2,class:"slide-scale-wrapper play-view",ref_key:"slideWrapperRef",ref:V},[c("div",{class:"slide-display",style:v({backgroundColor:s.value.background_color||"#FFFFFF",width:"100%",height:"100%"})},[s.value.background_image_url?(l(),a("div",{key:0,class:"background-image",style:v({backgroundImage:`url(${s.value.background_image_url})`,backgroundSize:s.value.background_image_fit||"cover",backgroundPosition:s.value.background_image_position||"center",backgroundRepeat:"no-repeat",opacity:s.value.background_image_opacity||1,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:0})},null,4)):p("",!0),W.value?(l(),a("div",ae,[((o=_.value[s.value.slide_id])==null?void 0:o.length)>0?(l(!0),a(G,{key:0},Q(_.value[s.value.slide_id],t=>(l(),a("div",{key:t.element_id,class:Y(t.element_type==="image"?"image-element":"text-element"),style:v({position:"absolute",left:`${t.x_position}px`,top:`${t.y_position}px`,width:`${t.width}px`,height:`${t.height}px`,zIndex:t.z_index,...t.element_type==="text"?{fontFamily:t.font_family,fontSize:`${t.font_size}px`,color:t.font_color,fontWeight:t.bold?"bold":"normal",fontStyle:t.italic?"italic":"normal",textDecoration:t.underline?"underline":"none",textAlign:t.text_align,background:"rgba(0,0,0,0)",border:"none",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",padding:0}:{background:"transparent",border:"none",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:0}})},[t.element_type==="text"?(l(),a("div",{key:0,class:"element-content",style:v({width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",textAlign:t.text_align,overflow:"hidden",wordBreak:"break-word",color:t.font_color,fontSize:`${t.font_size}px`,fontWeight:t.bold?"bold":"normal",fontStyle:t.italic?"italic":"normal",textDecoration:t.underline?"underline":"none",padding:"2px",lineHeight:"1.2"})},[c("div",{innerHTML:M(t),style:{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center"}},null,8,le)],4)):t.element_type==="image"?(l(),a("div",re,[c("img",{src:t.image_url,alt:t.alt_text,style:{"max-width":"100%","max-height":"100%","object-fit":"contain"}},null,8,de)])):p("",!0)],6))),128)):p("",!0)])):(l(),a("div",se," Loading slide content... "))],4)],512)):p("",!0),c("div",ce,[c("button",{onClick:k(S,["stop"]),disabled:w.value,class:"nav-button prev-button"}," Previous ",8,ue),c("span",_e," Slide "+x(((e=s.value)==null?void 0:e.slide_number)||0)+" of "+x(r.value.length),1),c("button",{onClick:k(b,["stop"]),disabled:F.value,class:"nav-button next-button"}," Next ",8,pe),c("button",{onClick:k(z,["stop"]),class:"exit-button"}," Exit ")])])}}};export{ye as default};
