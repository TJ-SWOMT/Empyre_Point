import{r as c,n as O,q as _e,c as _,b as $,o as f,a as o,t as A,d as wt,s as ie,w as M,z as et,F as Ee,k as tt,v as F,h as Ce,m as kt,j as St,p as Et,e as Ct,x as oe,u as ae,i as It,y as Z}from"./index-D0AzF91-.js";import{p as E,h as L}from"./api-DgzFD1Ui.js";import{u as zt,m as Nt}from"./useSlideScale-COT8W2B9.js";const Mt={class:"background-image-modal-header"},$t={class:"modal-body"},Rt={key:0,class:"error-message"},Ut={key:1,class:"background-image-upload-section"},Bt={class:"background-image-upload-button"},Tt=["disabled"],Ft={key:2,class:"background-image-preview-section"},Dt={key:3,class:"background-image-controls-section"},Ot={class:"background-image-control-group"},Lt=["value"],At={class:"background-image-control-group"},Vt={class:"background-image-opacity-value"},Wt={class:"background-image-action-buttons"},Pt={__name:"BackgroundImageModal",props:{show:{type:Boolean,required:!0},currentImage:{type:String,default:null},currentOpacity:{type:Number,default:1},currentFit:{type:String,default:"cover"}},emits:["close","update","remove"],setup(Q,{emit:ee}){const x=Q,C=ee,m=c(!1),w=c(""),N=c(x.currentOpacity),b=c(x.currentFit),z=c(x.currentImage),H=O(()=>!!x.currentImage),Y=[{value:"cover",label:"Cover (Fill)"},{value:"contain",label:"Contain (Fit)"},{value:"stretch",label:"Stretch"}],Ie=async I=>{const h=I.target.files[0];if(!h)return;let k=null;try{m.value=!0,w.value="";const J=new Image;k=URL.createObjectURL(h),await new Promise((se,g)=>{J.onload=se,J.onerror=g,J.src=k});const D=await E.uploadImage(h);if(D.error)throw new Error(D.error);z.value=D.image_url}catch(J){w.value=L(J),console.error("Error uploading image:",J)}finally{m.value=!1,k&&URL.revokeObjectURL(k)}},te=()=>{},fe=()=>{},he=()=>{z.value=null},re=()=>{z.value=x.currentImage,N.value=x.currentOpacity,b.value=x.currentFit,C("close")},R=()=>{z.value?C("update",{image_url:z.value,opacity:N.value,fit:b.value}):C("remove"),C("close")};return _e(()=>x.currentImage,I=>{z.value=I}),_e(()=>x.currentOpacity,I=>{N.value=I}),_e(()=>x.currentFit,I=>{b.value=I}),(I,h)=>Q.show?(f(),_("div",{key:0,class:"background-image-modal-overlay",onClick:re},[o("div",{class:"background-image-modal-content",onClick:h[3]||(h[3]=Ce(()=>{},["stop"]))},[o("div",Mt,[o("h2",null,A(H.value?"Edit Background Image":"Set Background Image"),1),o("button",{class:"background-image-modal-close-button",onClick:re},"Ã—")]),o("div",$t,[w.value?(f(),_("div",Rt,A(w.value),1)):$("",!0),H.value?$("",!0):(f(),_("div",Ut,[o("label",Bt,[o("input",{type:"file",accept:"image/*",onChange:Ie,disabled:m.value},null,40,Tt),wt(" "+A(m.value?"Uploading...":"Upload Image"),1)])])),z.value?(f(),_("div",Ft,[o("div",{class:"background-image-preview-container",style:ie({backgroundImage:`url(${z.value})`,backgroundSize:b.value==="stretch"?"100% 100%":b.value,backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:N.value})},null,4)])):$("",!0),z.value?(f(),_("div",Dt,[o("div",Ot,[h[4]||(h[4]=o("label",{for:"fit"},"Image Fit:",-1)),M(o("select",{id:"fit","onUpdate:modelValue":h[0]||(h[0]=k=>b.value=k),onChange:fe},[(f(),_(Ee,null,tt(Y,k=>o("option",{key:k.value,value:k.value},A(k.label),9,Lt)),64))],544),[[et,b.value]])]),o("div",At,[h[5]||(h[5]=o("label",{for:"opacity"},"Opacity:",-1)),M(o("input",{id:"opacity",type:"range","onUpdate:modelValue":h[1]||(h[1]=k=>N.value=k),min:"0",max:"1",step:"0.1",onInput:te},null,544),[[F,N.value,void 0,{number:!0}]]),o("span",Vt,A(Math.round(N.value*100))+"%",1)]),o("div",Wt,[o("button",{class:"background-image-remove-button",onClick:he}," Remove Background Image "),H.value?(f(),_("button",{key:0,class:"background-image-upload-new-button",onClick:h[2]||(h[2]=k=>z.value=null)}," Upload New Image ")):$("",!0)]),o("div",{class:"background-image-modal-action-buttons"},[o("button",{class:"background-image-cancel-button",onClick:re},"Cancel"),o("button",{class:"background-image-ok-button",onClick:R},"OK")])])):$("",!0)])])])):$("",!0)}},Ht=(Q,ee)=>{const x=Q.__vccOpts||Q;for(const[C,m]of ee)x[C]=m;return x},Xt={class:"page-content-wrapper"},Yt={class:"page-header"},jt={class:"page-header-text"},qt={class:"action-bar-container"},Kt={class:"action-bar-content"},Jt={class:"slide-controls-container"},Gt={class:"slide-background-edit-actions"},Zt={class:"color-picker"},Qt={class:"slide-title-container"},en={key:0,class:"error-message"},tn={class:"slide-editor-content"},nn={key:0,class:"loading-container"},ln=["onClick","onDblclick"],on={key:0,class:"element-controls"},an=["onClick"],rn=["innerHTML"],sn={key:2,class:"image-container",style:{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center",overflow:"hidden"}},un=["src","alt"],dn={class:"slide-number-input"},cn={class:"slide-number-wrapper"},vn=["max"],mn={class:"slide-number-total"},gn=["disabled"],pn=["disabled"],_n={class:"styling-controls"},fn={key:0,class:"control-group"},hn={key:1,class:"control-group"},bn={key:2,class:"control-group"},yn={class:"control-group"},xn={class:"control-group"},wn={class:"control-group"},kn={class:"control-group"},Sn={class:"control-group"},En={__name:"SlideEditorView",setup(Q){const ee=kt(),x=It(),C=ee.params.id,m=c(ee.params.slide_id),w=c(""),N=c(!1),b=O(()=>!!m.value),z=c(""),H=c(!1),Y=c(null);c(null);const Ie=c(null),te=c(600),fe=c(null),he=c(window.innerWidth);function re(){Z(()=>{fe.value?he.value=fe.value.offsetWidth:he.value=window.innerWidth})}const{scale:R,DESIGN_WIDTH:I,DESIGN_HEIGHT:h,calculateScale:k}=zt(te,O(()=>window.innerWidth)),D=c(sessionStorage.getItem(`slideBackgroundColor_${C}`)||"#FFFFFF"),se=c(null);_e(D,t=>{sessionStorage.setItem(`slideBackgroundColor_${C}`,t)}),c([]);const g=c([]),r=c(null),be=c(!1),ze=O({get:()=>{var t,e;return Math.round(((e=(t=r.value)==null?void 0:t.element_data)==null?void 0:e.font_size)||0)},set:t=>{r.value&&(r.value.element_data.font_size=Math.round(t))}}),Ne=O({get:()=>{var t;return Math.round(((t=r.value)==null?void 0:t.x_position)||0)},set:t=>{r.value&&(r.value.x_position=Math.round(t))}}),Me=O({get:()=>{var t;return Math.round(((t=r.value)==null?void 0:t.y_position)||0)},set:t=>{r.value&&(r.value.y_position=Math.round(t))}}),$e=O({get:()=>{var t;return Math.round(((t=r.value)==null?void 0:t.width)||0)},set:t=>{r.value&&(r.value.width=Math.round(t))}}),Re=O({get:()=>{var t;return Math.round(((t=r.value)==null?void 0:t.height)||0)},set:t=>{r.value&&(r.value.height=Math.round(t))}}),Ue=O({get:()=>{var t;return Math.round(((t=r.value)==null?void 0:t.z_index)||0)},set:t=>{r.value&&(r.value.z_index=Math.round(t))}}),nt=O(()=>`${b.value}-${m.value}-${G.value}-${V.value}-${N.value}`),Be=c(!1),ue=c(null),de=c(1),ce=c("cover"),ne=c(null),ve=c(1),le=c("cover"),G=c(0),V=c(null),ye=c(!0);c(0);const xe=c(!0),j=c(!0),lt=async()=>{try{j.value=!0;const t=await E.getPresentation(C);if(t.error)throw new Error(t.error);if(G.value=t.presentation.slides.length,!b.value){V.value=G.value+1,j.value=!1;return}const e=t.presentation.slides.find(n=>Number(n.slide_id)===Number(m.value));if(e)se.value={...e,slide_id:Number(e.slide_id)},V.value=e.slide_number,D.value=e.background_color||"#FFFFFF",z.value=e.title||"",ue.value=e.background_image_url||null,de.value=e.background_image_opacity||1,ce.value=e.background_image_fit||"cover",ne.value=e.background_image_url||null,ve.value=e.background_image_opacity||1,le.value=e.background_image_fit||"cover";else throw new Error("Slide not found")}catch(t){w.value=L(t)}finally{j.value=!1}},ot=async()=>{if(!b.value){j.value=!1;return}try{j.value=!0;const t=await E.getSlideElements(m.value);if(t.error)throw new Error(t.error);g.value=t.elements||[]}catch(t){w.value=L(t)}finally{j.value=!1}};async function at(t,e,n){const s=await E.getPresentation(t);if(!s.success)return;let a=s.presentation.slides.sort((l,i)=>l.slide_number-i.slide_number);const d=a.findIndex(l=>String(l.slide_id)===String(e));let u;if(d!==-1?[u]=a.splice(d,1):u=(await E.getPresentation(t)).presentation.slides.find(i=>String(i.slide_id)===String(e)),!!u){a.splice(n-1,0,u);for(let l=0;l<a.length;l++){const i=a[l],v=l+1;i.slide_number!==v&&await E.updateSlide(i.slide_id,v,i.background_color,i.background_image_url,i.title,i.background_image_opacity,i.background_image_fit)}}}const Te=async(t=!1)=>{var e,n;try{N.value=!0,w.value="",ue.value=ne.value,de.value=ve.value,ce.value=le.value;let s,a=!1,d=(e=se.value)==null?void 0:e.slide_number;if(b.value&&!m.value.toString().startsWith("temp-"))s=await E.updateSlide(Number(m.value),V.value!==((n=se.value)==null?void 0:n.slide_number)?V.value:void 0,D.value,ue.value,z.value,de.value,ce.value);else{const l=await E.getPresentation(C);if(l.error)throw new Error(l.error);const i=l.presentation.slides.length>0?Math.max(...l.presentation.slides.map(p=>p.slide_number)):0,v=V.value;s=await E.createSlide(C,v,D.value,ue.value,z.value,de.value,ce.value),a=!0}if(s.error)throw new Error(s.error);(!b.value||m.value.toString().startsWith("temp-"))&&(m.value=s.slide.slide_id);const u=g.value.map(async l=>{var i,v,p,y,T,S,W,K;if(l.element_id.toString().startsWith("temp-")){if(l.element_type==="text"){const P=await E.createTextElement(m.value,{content:l.element_data.content,x_position:l.x_position,y_position:l.y_position,width:l.width,height:l.height,z_index:l.z_index,font_family:l.element_data.font_family,font_size:l.element_data.font_size,font_color:l.element_data.font_color,bold:l.element_data.bold,italic:l.element_data.italic,underline:l.element_data.underline,text_align:l.element_data.text_align});if(P.error)throw new Error(P.error);return P.element}else if(l.element_type==="image"){const P=await E.createImageElement(m.value,{image_url:l.element_data.image_url,x_position:l.x_position,y_position:l.y_position,width:l.width,height:l.height,z_index:l.z_index});if(P.error)throw new Error(P.error);return P.element}}else return X(l.element_id,{x_position:l.x_position,y_position:l.y_position,width:l.width,height:l.height,z_index:l.z_index,font_family:(i=l.element_data)==null?void 0:i.font_family,font_size:(v=l.element_data)==null?void 0:v.font_size,font_color:(p=l.element_data)==null?void 0:p.font_color,bold:(y=l.element_data)==null?void 0:y.bold,italic:(T=l.element_data)==null?void 0:T.italic,underline:(S=l.element_data)==null?void 0:S.underline,text_align:(W=l.element_data)==null?void 0:W.text_align,content:(K=l.element_data)==null?void 0:K.content})});if(await Promise.all(u),await at(C,m.value,V.value),t)x.push(`/presentations/${C}`);else if(!b.value&&s.slide)return x.replace(`/presentations/${C}/slides/${s.slide.slide_id}`),s}catch(s){return w.value=L(s),null}finally{N.value=!1}},it=()=>{be.value=!0;const t=document.querySelector(".slide-container");t&&(t.style.cursor="text")},rt=async t=>{if(t&&(t.preventDefault(),t.stopPropagation()),!H.value){H.value=!0;return}try{await E.deleteSlide(m.value),x.push(`/presentations/${C}`)}catch(e){w.value=L(e),H.value=!1}},st=()=>{H.value=!1},Oe=t=>{!t.target.closest(".text-element")&&!t.target.closest(".element-styling")&&!t.target.closest(".delete-slide-button")&&st()},ut=async()=>{try{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async e=>{const n=e.target.files[0];if(!n)return;let s=null;try{const a=new Image;s=URL.createObjectURL(n),await new Promise((S,W)=>{a.onload=S,a.onerror=W,a.src=s});const d=I/h,u=a.width/a.height;let l,i;u>d?(l=I*.9,i=l/u):(i=h*.9,l=i*u),l=Math.round(l),i=Math.round(i);const v=await E.uploadImage(n);if(v.error)throw new Error(v.error);!b.value&&!m.value&&(m.value="temp-"+Date.now());const p=Math.round((I-l)/2),y=Math.round((h-i)/2),T={image_url:v.image_url,x_position:p,y_position:y,width:l,height:i,z_index:g.value.length||0};if(b.value&&!m.value.toString().startsWith("temp-")){const S=await E.createImageElement(m.value,T);if(S.error)throw new Error(S.error);g.value.push({element_id:S.element.element_id,element_type:"image",x_position:p,y_position:y,width:l,height:i,z_index:g.value.length||0,element_data:{image_url:v.image_url,alt_text:"",natural_width:a.width,natural_height:a.height}})}else{const S="temp-"+Date.now();g.value.push({element_id:S,element_type:"image",x_position:p,y_position:y,width:l,height:i,z_index:g.value.length||0,element_data:{image_url:v.image_url,alt_text:"",natural_width:a.width,natural_height:a.height}})}r.value=g.value[g.value.length-1]}catch(a){w.value=L(a),console.error("Error in image upload handler:",a)}finally{s&&URL.revokeObjectURL(s)}},t.click()}catch(t){w.value=L(t),console.error("Error adding image:",t)}},we=O(()=>{if(!r.value||r.value.element_type!=="image")return null;const{natural_width:t,natural_height:e}=r.value.element_data;return t/e}),Le=async(t,e)=>{if(!r.value||r.value.element_type!=="image")return;const n={};t!==void 0?(n.width=t,we.value&&(n.height=Math.round(t/we.value))):e!==void 0&&(n.height=e,we.value&&(n.width=Math.round(e*we.value))),await X(r.value.element_id,n)},me=c(null),Fe=c(null),De=c(null),q=t=>{if(!t)throw console.error("Missing element ID"),new Error("Missing element ID");const e=typeof t=="string"?parseInt(t,10):t;if(isNaN(e))throw console.error("Invalid element ID:",t),new Error("Invalid element ID");return e},ke=c(null),X=async(t,e)=>{var n;try{const s=q(t);console.log("Updating element with ID:",s,"Updates:",e);const a=g.value.find(i=>q(i.element_id)===s);if(!a)throw new Error("Element not found");const d=Object.entries(e).reduce((i,[v,p])=>(typeof p=="number"?i[v]=Math.round(p):i[v]=p,i),{}),u=await E.updateElement(s,{element_type:a.element_type,...d});if(console.log("Server response:",JSON.stringify(u,null,2)),u.error)throw new Error(u.error);if(!u.success||!u.element)throw console.error("Invalid server response:",u),new Error("Invalid server response");const l=g.value.map(i=>{var v,p;if(q(i.element_id)===s){const y={element_id:s,element_type:a.element_type,x_position:u.element.x_position,y_position:u.element.y_position,width:u.element.width,height:u.element.height,z_index:u.element.z_index,element_data:a.element_type==="text"?{content:u.element.content,font_family:u.element.font_family,font_size:u.element.font_size,font_color:u.element.font_color,bold:u.element.bold,italic:u.element.italic,underline:u.element.underline,text_align:u.element.text_align}:{image_url:u.element.image_url,alt_text:u.element.alt_text,natural_width:(v=i.element_data)==null?void 0:v.natural_width,natural_height:(p=i.element_data)==null?void 0:p.natural_height}};return console.log("Updated element:",JSON.stringify(y,null,2)),y}return i});if(g.value=[...l],((n=r.value)==null?void 0:n.element_id)===s){const i=l.find(v=>q(v.element_id)===s);console.log("Setting new selected element:",JSON.stringify(i,null,2)),r.value={...i}}return Z(()=>{console.log("Elements after nextTick:",JSON.stringify(g.value,null,2))}),!0}catch(s){return w.value=L(s),console.error("Error updating element:",s),!1}},dt=async(t,e)=>{try{if(!b.value||m.value.toString().startsWith("temp-")){const n="temp-"+Date.now(),s=Math.round(Number(t)||0),a=Math.round(Number(e)||0),d={content:"New Text",font_family:"Arial",font_size:18,font_color:"#000000",bold:!1,italic:!1,underline:!1,text_align:"left"},u={element_id:n,element_type:"text",x_position:s,y_position:a,width:200,height:100,z_index:g.value.length||0,element_data:d};if(g.value.push(u),r.value=u,Z(()=>{B.value=!0,U.value=d.content,setTimeout(()=>{const l=document.querySelector(".text-element.editing textarea");l&&(l.focus(),l.setSelectionRange(0,l.value.length),l.style.opacity="1",l.style.background="rgba(255,255,255,0.95)")},50)}),!m.value||m.value.toString().startsWith("temp-")){const l=await Te(!1);if(!l)throw g.value=g.value.filter(y=>y.element_id!==n),r.value=null,new Error("Failed to save slide before adding element");m.value=l.slide.slide_id;const i=await E.createTextElement(m.value,{content:d.content,x_position:s,y_position:a,width:200,height:100,z_index:g.value.length||0,font_family:d.font_family,font_size:d.font_size,font_color:d.font_color,bold:d.bold,italic:d.italic,underline:d.underline,text_align:d.text_align});if(i.error)throw new Error(i.error);const p={element_id:q(i.element.element_id),element_type:"text",x_position:Math.round(Number(i.element.x_position??s)),y_position:Math.round(Number(i.element.y_position??a)),width:Math.round(Number(i.element.width??200)),height:Math.round(Number(i.element.height??100)),z_index:Math.round(Number(i.element.z_index??g.value.length)),element_data:{content:d.content,font_family:d.font_family,font_size:Math.round(Number(d.font_size)),font_color:d.font_color,bold:d.bold,italic:d.italic,underline:d.underline,text_align:d.text_align}};g.value=g.value.map(y=>y.element_id===n?p:y),r.value=p}}else{const n=Math.round(Number(t)||0),s=Math.round(Number(e)||0),a={content:"New Text",font_family:"Arial",font_size:18,font_color:"#000000",bold:!1,italic:!1,underline:!1,text_align:"left"},d=await E.createTextElement(m.value,{content:a.content,x_position:n,y_position:s,width:200,height:100,z_index:g.value.length||0,font_family:a.font_family,font_size:a.font_size,font_color:a.font_color,bold:a.bold,italic:a.italic,underline:a.underline,text_align:a.text_align});if(d.error)throw new Error(d.error);const l={element_id:q(d.element.element_id),element_type:"text",x_position:Math.round(Number(d.element.x_position??n)),y_position:Math.round(Number(d.element.y_position??s)),width:Math.round(Number(d.element.width??200)),height:Math.round(Number(d.element.height??100)),z_index:Math.round(Number(d.element.z_index??g.value.length)),element_data:{content:a.content,font_family:a.font_family,font_size:Math.round(Number(a.font_size)),font_color:a.font_color,bold:a.bold,italic:a.italic,underline:a.underline,text_align:a.text_align}};g.value.push(l),r.value=l,Z(()=>{B.value=!0,U.value=a.content,setTimeout(()=>{const i=document.querySelector(".text-element.editing textarea");i&&(i.focus(),i.setSelectionRange(0,i.value.length),i.style.opacity="1",i.style.background="rgba(255,255,255,0.95)")},50)})}}catch(n){w.value=L(n),console.error("Error creating text element:",n)}},ct=async t=>{var e;try{const n=q(t),s=await E.deleteElement(n);if(s.error)throw new Error(s.error);g.value=g.value.filter(a=>q(a.element_id)!==n),((e=r.value)==null?void 0:e.element_id)===n&&(r.value=null,B.value=!1)}catch(n){w.value=L(n),console.error("Error deleting element:",n)}},vt=t=>{r.value=t},B=c(!1),U=c("");c(null);const mt=t=>{var e,n;r.value=t,B.value=!0,ke.value={content:((e=t.element_data)==null?void 0:e.content)||"",element_id:t.element_id},U.value=((n=t.element_data)==null?void 0:n.content)||"",Z(()=>{const s=document.querySelector(".text-element.editing textarea");if(s){s.focus();const a=s.value.length;s.setSelectionRange(a,a)}})},Ae=async()=>{var t,e,n,s;if(r.value)try{if(U.value===((t=r.value.element_data)==null?void 0:t.content)){B.value=!1;return}U.value.trim()?await X(r.value.element_id,{content:U.value})?(B.value=!1,U.value=""):U.value=((e=r.value.element_data)==null?void 0:e.content)||"":(U.value=((n=r.value.element_data)==null?void 0:n.content)||"",B.value=!1)}catch(a){w.value=L(a),console.error("Error finishing edit:",a),U.value=((s=r.value.element_data)==null?void 0:s.content)||""}},gt=t=>{t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),Ae()):t.key==="Escape"&&(t.preventDefault(),ke.value&&(U.value=ke.value.content),B.value=!1,ke.value=null)},Ve=t=>{!t.target.closest(".text-element")&&!t.target.closest(".element-styling")&&(r.value=null,B.value=!1)},pt=t=>{if(!be.value||t.target.closest(".element"))return;const e=t.currentTarget;if(!e){console.error("Slide container not found");return}(!R.value||isNaN(R.value)||R.value<=0)&&(console.error("Invalid scale value:",R.value),k(),(!R.value||isNaN(R.value)||R.value<=0)&&(R.value=1));const n=e.getBoundingClientRect(),s=t.clientX-n.left,a=t.clientY-n.top,d=n.width/2,u=n.height/2,l=s-d,i=a-u,v=R.value||1,p=l/v,y=i/v,T=p+I/2,S=y+h/2;if(isNaN(T)||isNaN(S)){console.error("Invalid coordinates after calculation:",{clickX:s,clickY:a,relativeX:l,relativeY:i,scaledX:p,scaledY:y,finalX:T,finalY:S,scale:v,rect:n,DESIGN_WIDTH:I,DESIGN_HEIGHT:h});return}const W=Math.max(0,Math.min(T,I)),K=Math.max(0,Math.min(S,h));console.log("Creating text element at position:",{click:{x:s,y:a},relative:{x:l,y:i},scaled:{x:p,y},final:{x:T,y:S},bounded:{x:W,y:K},scale:v,design:{width:I,height:h}}),dt(W,K),be.value=!1,e&&(e.style.cursor="default")},_t=()=>{ye.value=!ye.value,Z(()=>{ge()})};function ge(){Z(()=>{var d,u,l,i,v,p;const t=((d=Y.value)==null?void 0:d.getBoundingClientRect().height)||0,e=ye.value?((l=(u=Y.value)==null?void 0:u.querySelector(".action-bar-content"))==null?void 0:l.getBoundingClientRect().height)||0:((v=(i=Y.value)==null?void 0:i.querySelector(".action-bar-toggle"))==null?void 0:v.getBoundingClientRect().height)||0,n=((p=Ie.value)==null?void 0:p.getBoundingClientRect().height)||0,a=window.innerHeight-(t+e+n+16);a>0?(te.value=a,k()):(console.warn("Invalid height calculated:",a),te.value=600,k()),re()})}const ft=()=>{document.removeEventListener("mousedown",Ve),document.removeEventListener("mousedown",Oe),window.removeEventListener("resize",ge),Se.value&&Se.value.disconnect()},Se=c(null);St(()=>{if(me.value=document.querySelector(".slide-container"),Fe.value=document.getElementById("x"),De.value=document.getElementById("y"),me.value){const t=e=>{Fe.value&&De.value&&(Fe.value.innerText=e.pageX,De.value.innerText=e.pageY)};me.value.addEventListener("mousemove",t),me.value.addEventListener("mouseenter",t),me.value.addEventListener("mouseleave",t)}document.addEventListener("mousedown",Ve),document.addEventListener("mousedown",Oe),ge(),window.addEventListener("resize",ge),Se.value=new ResizeObserver(()=>{ge()}),Y.value&&Se.value.observe(Y.value),lt(),b.value&&ot()}),Et(ft),_e(R,t=>{(!t||isNaN(t)||t<=0)&&(console.warn("Invalid scale detected, recalculating..."),k())},{immediate:!0});const ht=(t,e)=>{t.element_type==="text"&&(e.stopPropagation(),mt(t))},bt=t=>{ne.value=t.image_url,ve.value=t.opacity,le.value=t.fit},yt=()=>{ne.value=null,ve.value=1,le.value="cover"},xt=()=>{xe.value=!xe.value};return(t,e)=>(f(),_("div",Xt,[o("div",Yt,[o("div",jt,A(b.value?"Edit Slide":"Create Slide"),1)]),o("div",{class:"page-actions",ref_key:"headerRef",ref:Y},[o("div",qt,[o("div",Kt,[o("div",Jt,[o("button",{onClick:it,class:oe({active:be.value}),title:"Click to add text, then click on the slide where you want the text to appear"}," Add Text ",2),o("button",{onClick:ut},"Add Image"),o("button",{onClick:e[0]||(e[0]=Ce(n=>rt(n),["stop"])),class:"btn btn-danger delete-slide-button"},A(H.value?"Click again to delete":"Delete Slide"),1)]),o("div",Gt,[o("div",Zt,[e[26]||(e[26]=o("label",{for:"backgroundColor"},"Background Color:",-1)),M(o("input",{type:"color",id:"backgroundColor","onUpdate:modelValue":e[1]||(e[1]=n=>D.value=n),title:"Choose slide background color"},null,512),[[F,D.value]])]),o("button",{onClick:e[2]||(e[2]=n=>Be.value=!0)},"Set Background Image")]),o("div",Qt,[e[27]||(e[27]=o("label",{for:"slideTitle"},"Slide Title:",-1)),M(o("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=n=>z.value=n),placeholder:"Slide Title"},null,512),[[F,z.value]])])]),o("button",{class:oe(["action-bar-toggle",{"is-active":ye.value}]),onClick:_t,"aria-label":"Toggle action bar"},e[28]||(e[28]=[o("span",null,null,-1),o("span",null,null,-1),o("span",null,null,-1)]),2)])],512),w.value?(f(),_("div",en,A(w.value),1)):$("",!0),o("div",tn,[j.value?(f(),_("div",nn,e[29]||(e[29]=[o("div",{class:"loading-spinner"},null,-1),o("div",{class:"loading-text"},"Loading slide...",-1)]))):(f(),_("div",{key:1,class:"slide-scale-wrapper",style:ie({width:"100%",height:te.value+"px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"})},[o("div",{class:"slide-container",style:ie({backgroundColor:D.value,width:ae(I)+"px",height:ae(h)+"px",transform:`scale(${ae(R)})`,transformOrigin:"center center",position:"relative"}),onClick:pt},[ne.value?(f(),_("div",{key:0,class:"background-image-layer",style:ie({backgroundImage:`url(${ne.value})`,backgroundSize:le.value==="stretch"?"100% 100%":le.value,backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:ve.value,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:0})},null,4)):$("",!0),(f(!0),_(Ee,null,tt(g.value,n=>{var s,a,d,u,l,i,v,p,y,T,S,W,K,P,We,Pe,He,Xe,Ye,je,qe,Ke,Je,Ge,Ze,Qe;return f(),_("div",{key:`element-${n.element_id}-${((s=n.element_data)==null?void 0:s.image_url)||((a=n.element_data)==null?void 0:a.content)}`,class:oe(["element",{selected:((d=r.value)==null?void 0:d.element_id)===n.element_id,"text-element":n.element_type==="text","image-element":n.element_type==="image",editing:((u=r.value)==null?void 0:u.element_id)===n.element_id&&B.value&&n.element_type==="text"}]),style:ie({position:"absolute",left:`${n.x_position}px`,top:`${n.y_position}px`,width:`${n.width}px`,height:`${n.height}px`,zIndex:n.z_index+1,...n.element_type==="text"?{fontFamily:((l=n.element_data)==null?void 0:l.font_family)||"Arial",fontSize:`${((i=n.element_data)==null?void 0:i.font_size)||18}px`,color:((v=n.element_data)==null?void 0:v.font_color)||"#000000",fontWeight:(p=n.element_data)!=null&&p.bold?"bold":"normal",fontStyle:(y=n.element_data)!=null&&y.italic?"italic":"normal",textDecoration:(T=n.element_data)!=null&&T.underline?"underline":"none",textAlign:((S=n.element_data)==null?void 0:S.text_align)||"left",background:"rgba(255,255,255,0.1)",border:"2px solid rgba(0,0,0,0.5)",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",padding:0,cursor:n.element_type==="text"?"text":"move"}:{background:"transparent",border:"2px solid rgba(0,0,0,0.5)",boxSizing:"border-box",overflow:"hidden"}}),onClick:Ce(pe=>vt(n),["stop"]),onDblclick:pe=>ht(n,pe)},[((W=r.value)==null?void 0:W.element_id)===n.element_id?(f(),_("div",on,[o("button",{onClick:Ce(pe=>ct(n.element_id),["stop"]),class:"delete-btn"}," Ã— ",8,an)])):$("",!0),n.element_type==="text"?(f(),_("div",{key:1,class:oe(["text-editor",{editing:((K=r.value)==null?void 0:K.element_id)===n.element_id&&B.value,"new-element":!((P=n.element_data)!=null&&P.content)||((We=n.element_data)==null?void 0:We.content)==="New Text"}])},[((Pe=r.value)==null?void 0:Pe.element_id)===n.element_id&&B.value?M((f(),_("textarea",{key:0,"onUpdate:modelValue":e[4]||(e[4]=pe=>U.value=pe),onBlur:Ae,onKeydown:gt,style:ie({fontFamily:((He=n.element_data)==null?void 0:He.font_family)||"Arial",fontSize:`${((Xe=n.element_data)==null?void 0:Xe.font_size)||18}px`,color:((Ye=n.element_data)==null?void 0:Ye.font_color)||"#000000",fontWeight:(je=n.element_data)!=null&&je.bold?"bold":"normal",fontStyle:(qe=n.element_data)!=null&&qe.italic?"italic":"normal",textDecoration:(Ke=n.element_data)!=null&&Ke.underline?"underline":"none",textAlign:((Je=n.element_data)==null?void 0:Je.text_align)||"left",width:"100%",height:"100%",border:"2px solid #28a745",background:"rgba(255,255,255,0.95)",resize:"none",outline:"none",padding:"5px",boxShadow:"none",boxSizing:"border-box",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",display:"block",opacity:"1",transition:"opacity 0.1s ease-in-out",cursor:"text"})},null,36)),[[F,U.value]]):(f(),_("div",{key:1,innerHTML:ae(Nt)(((Ge=n.element_data)==null?void 0:Ge.content)||""),style:{width:"100%",height:"100%",display:"flex","align-items":"center","justify-content":"center",padding:"5px","box-sizing":"border-box",background:"rgba(255, 255, 255, 0.1)",cursor:"text"}},null,8,rn))],2)):n.element_type==="image"?(f(),_("div",sn,[o("img",{src:(Ze=n.element_data)==null?void 0:Ze.image_url,alt:((Qe=n.element_data)==null?void 0:Qe.alt_text)||"",style:{"max-width":"100%","max-height":"100%","object-fit":"contain"}},null,8,un)])):$("",!0)],46,ln)}),128))],4),(f(),_("div",{class:"action-buttons centered-under-slide",key:nt.value},[o("div",dn,[e[32]||(e[32]=o("label",{for:"slideNumber"},"Slide Number:",-1)),o("div",cn,[!j.value&&V.value!==null?(f(),_(Ee,{key:0},[M(o("input",{id:"slideNumber",type:"number","onUpdate:modelValue":e[5]||(e[5]=n=>V.value=n),min:1,max:b.value?G.value:G.value+1,step:"1"},null,8,vn),[[F,V.value,void 0,{number:!0}]]),o("span",mn,"of "+A(b.value?G.value:G.value+1),1)],64)):(f(),_(Ee,{key:1},[e[30]||(e[30]=o("div",{style:{width:"100px",height:"44px",background:"#eee","border-radius":"8px",display:"inline-block",animation:"pulse 1.2s infinite","margin-right":"8px"}},null,-1)),e[31]||(e[31]=o("span",{class:"slide-number-total"},"of ...",-1))],64))])]),o("button",{onClick:e[6]||(e[6]=n=>ae(x).push(`/presentations/${ae(C)}`)),class:"cancel-button"}," Cancel "),o("button",{onClick:e[7]||(e[7]=n=>Te(!1)),disabled:N.value,class:"save-button"},A(N.value?"Saving...":b.value?"Save Changes":"Create Slide"),9,gn),o("button",{onClick:e[8]||(e[8]=n=>Te(!0)),disabled:N.value,class:"save-and-return-button"},A(N.value?"Saving...":"Save & Return"),9,pn)]))],4))]),r.value?(f(),_("div",{key:1,class:oe(["element-styling",{"is-expanded":xe.value}])},[o("button",{class:oe(["styling-toggle",{"is-active":xe.value}]),onClick:xt,"aria-label":"Toggle styling controls"},e[33]||(e[33]=[o("span",null,"Style",-1),o("span",{class:"toggle-icon"},null,-1)]),2),o("div",_n,[r.value.element_type==="text"?(f(),_("div",fn,[e[35]||(e[35]=o("label",{for:"font-family"},"Font:",-1)),M(o("select",{id:"font-family","onUpdate:modelValue":e[9]||(e[9]=n=>r.value.element_data.font_family=n),onChange:e[10]||(e[10]=n=>X(r.value.element_id,{font_family:r.value.element_data.font_family}))},e[34]||(e[34]=[o("option",{value:"Arial"},"Arial",-1),o("option",{value:"Times New Roman"},"Times New Roman",-1),o("option",{value:"Courier New"},"Courier New",-1)]),544),[[et,r.value.element_data.font_family]])])):$("",!0),r.value.element_type==="text"?(f(),_("div",hn,[e[36]||(e[36]=o("label",{for:"font-size"},"Size:",-1)),M(o("input",{id:"font-size",type:"number","onUpdate:modelValue":e[11]||(e[11]=n=>ze.value=n),onChange:e[12]||(e[12]=n=>X(r.value.element_id,{font_size:ze.value})),min:"8",max:"72",step:"1"},null,544),[[F,ze.value,void 0,{number:!0}]])])):$("",!0),r.value.element_type==="text"?(f(),_("div",bn,[e[37]||(e[37]=o("label",{for:"font-color"},"Color:",-1)),M(o("input",{id:"font-color",type:"color","onUpdate:modelValue":e[13]||(e[13]=n=>r.value.element_data.font_color=n),onChange:e[14]||(e[14]=n=>X(r.value.element_id,{font_color:r.value.element_data.font_color}))},null,544),[[F,r.value.element_data.font_color]])])):$("",!0),o("div",yn,[e[38]||(e[38]=o("label",{for:"x-position"},"X:",-1)),M(o("input",{id:"x-position",type:"number","onUpdate:modelValue":e[15]||(e[15]=n=>Ne.value=n),onChange:e[16]||(e[16]=n=>X(r.value.element_id,{x_position:Ne.value})),min:"0",step:"1",placeholder:"X"},null,544),[[F,Ne.value,void 0,{number:!0}]])]),o("div",xn,[e[39]||(e[39]=o("label",{for:"y-position"},"Y:",-1)),M(o("input",{id:"y-position",type:"number","onUpdate:modelValue":e[17]||(e[17]=n=>Me.value=n),onChange:e[18]||(e[18]=n=>X(r.value.element_id,{y_position:Me.value})),min:"0",step:"1",placeholder:"Y"},null,544),[[F,Me.value,void 0,{number:!0}]])]),o("div",wn,[e[40]||(e[40]=o("label",{for:"width"},"Width:",-1)),M(o("input",{id:"width",type:"number","onUpdate:modelValue":e[19]||(e[19]=n=>$e.value=n),onChange:e[20]||(e[20]=n=>Le($e.value,void 0)),min:"10",step:"1",placeholder:"Width"},null,544),[[F,$e.value,void 0,{number:!0}]])]),o("div",kn,[e[41]||(e[41]=o("label",{for:"height"},"Height:",-1)),M(o("input",{id:"height",type:"number","onUpdate:modelValue":e[21]||(e[21]=n=>Re.value=n),onChange:e[22]||(e[22]=n=>Le(void 0,Re.value)),min:"10",step:"1",placeholder:"Height"},null,544),[[F,Re.value,void 0,{number:!0}]])]),o("div",Sn,[e[42]||(e[42]=o("label",{for:"z-index"},"Z:",-1)),M(o("input",{id:"z-index",type:"number","onUpdate:modelValue":e[23]||(e[23]=n=>Ue.value=n),onChange:e[24]||(e[24]=n=>X(r.value.element_id,{z_index:Ue.value})),min:"0",step:"1",placeholder:"Z"},null,544),[[F,Ue.value,void 0,{number:!0}]])])])],2)):$("",!0),Ct(Pt,{show:Be.value,"current-image":ue.value,"current-opacity":de.value,"current-fit":ce.value,onClose:e[25]||(e[25]=n=>Be.value=!1),onUpdate:bt,onRemove:yt},null,8,["show","current-image","current-opacity","current-fit"])]))}},Nn=Ht(En,[["__scopeId","data-v-2fd0f5b2"]]);export{Nn as default};
