import{m as R,i as W,r as d,j as z,y as A,A as H,q as O,n as V,c as a,o as r,b as y,a as c,t as f,F as N,k as D,B as j,u as I,s as S,e as K}from"./index-D0AzF91-.js";import{p as C,h as T}from"./api-DgzFD1Ui.js";const L={class:"view-area-container"},J={key:0,class:"error-message"},M={key:1,class:"loading"},U={key:2,class:"no-slides"},q=["onClick","onKeyup"],Y={class:"slide-title"},Q={class:"thumbnail-text-elements"},X=["src"],Z={class:"slide-number"},k=960,w=540,ee={__name:"PresentationSlidesView",setup(B){const F=R(),u=W(),p=F.params.id,i=d([]),h=d(""),_=d(!0),v=d(null),E=d({}),$=d([]),P=d([]);let m=[];function g(t,s){t&&($.value[s]=t)}function b(t){const s=$.value[t];if(!s)return;const e=s.clientWidth,o=s.clientHeight,n=e/k,G=o/w;P.value[t]=Math.min(n,G)*.9}function x(){m.forEach(t=>t.disconnect()),m=[],i.value.forEach((t,s)=>{const e=$.value[s];if(e){const o=new ResizeObserver(()=>b(s));o.observe(e),m.push(o),b(s)}})}z(()=>{A(()=>x())}),H(()=>{m.forEach(t=>t.disconnect())}),O(i,()=>{A(()=>x())}),V(()=>{if(!i.value||i.value.length===0)return"";if(i.value.length===1)return"slides-center";const t=200,s=24,e=48,o=i.value.length*t+(i.value.length-1)*s;if(typeof window<"u"){const n=window.innerWidth-2*e;if(o<n)return"slides-between"}return"slides-scrollable"});const l=async t=>{try{const s=await C.getSlideElements(t);s.success&&s.elements&&(E.value[t]=s.elements.filter(e=>e.element_type==="text"||e.element_type==="image").map(e=>{var o;return{element_id:e.element_id,element_type:e.element_type,x_position:parseFloat(e.x_position),y_position:parseFloat(e.y_position),width:parseFloat(e.width),height:parseFloat(e.height),z_index:e.z_index||0,content:e.element_type==="text"?((o=e.element_data)==null?void 0:o.content)||"":null}}))}catch(s){console.error("Error fetching slide elements:",s)}};return z(async()=>{try{_.value=!0,h.value="";const t=await C.getPresentation(p);if(console.log("Full API Response:",JSON.stringify(t,null,2)),t.error)throw new Error(t.error);if(!t.success||!t.presentation)throw new Error("Failed to fetch presentation");let s=t.presentation.slides;if(!s||!Array.isArray(s))console.log("No slides array found, setting to empty array"),i.value=[];else if(s.length===1&&s[0]===null)console.log("Found [null] slides array, setting to empty array"),i.value=[];else{const e=s.filter(o=>o&&typeof o=="object"&&o.slide_id&&o.slide_number).map(o=>({...o,background_color:o.background_color||"#FFFFFF"}));i.value=e,await Promise.all(i.value.map(o=>l(o.slide_id)))}console.log("Final slides value:",JSON.stringify(i.value,null,2))}catch(t){h.value=T(t),console.error("Error fetching slides:",t)}finally{_.value=!1}}),(t,s)=>(r(),a("div",L,[h.value?(r(),a("div",J,f(h.value),1)):y("",!0),_.value?(r(),a("div",M,"Loading slides...")):!i.value||i.value.length===0?(r(),a("div",U,s[0]||(s[0]=[c("p",null,"No slides for this presentation.",-1)]))):y("",!0),c("div",{class:"slides-grid",ref_key:"slidesGrid",ref:v},[(r(!0),a(N,null,D(i.value,(e,o)=>(r(),a(N,{key:e.slide_id},[e&&e.slide_id?(r(),a("div",{key:0,class:"slide-thumbnail",onClick:n=>I(u).push(`/presentations/${I(p)}/slides/${Number(e.slide_id)}`),role:"button",tabindex:"0",onKeyup:j(n=>I(u).push(`/presentations/${I(p)}/slides/${Number(e.slide_id)}`),["enter"])},[c("div",Y,f(e.title?e.title:"Untitled"),1),c("div",{class:"thumbnail",ref_for:!0,ref:n=>g(n,o),style:S({backgroundColor:e.background_color})},[c("div",{class:"thumbnail-content",style:S({width:k+"px",height:w+"px",position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) scale(${P.value[o]||1})`,transformOrigin:"center center"})},[e.background_image_url?(r(),a("div",{key:0,class:"background-image",style:S({backgroundImage:`url(${e.background_image_url})`})},null,4)):y("",!0),c("div",Q,[(r(!0),a(N,null,D(E.value[e.slide_id],n=>(r(),a(N,{key:n.element_id},[n.element_type==="text"?(r(),a("div",{key:0,class:"thumbnail-text-element",style:S({left:`${n.x_position/k*100}%`,top:`${n.y_position/w*100}%`,width:`${n.width/k*100}%`,height:`${n.height/w*100}%`,zIndex:n.z_index})},f(n.content),5)):n.element_type==="image"?(r(),a("div",{key:1,class:"thumbnail-image-block",style:S({left:`${n.x_position/k*100}%`,top:`${n.y_position/w*100}%`,width:`${n.width/k*100}%`,height:`${n.height/w*100}%`,zIndex:n.z_index})},[c("img",{src:n.content,alt:"",style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,X)],4)):y("",!0)],64))),128))])],4)],4),c("div",Z,"Slide "+f(e.slide_number),1)],40,q)):y("",!0)],64))),128))],512)]))}},te={class:"page-content-wrapper"},se={class:"page-header"},ne={key:0,class:"page-header-text"},oe={key:1,class:"page-header-text"},ie={key:2,class:"error-message"},ae={class:"page-actions"},re=["disabled"],le={key:0,class:"presentation-description"},pe={__name:"PresentationView",setup(B){const F=R(),u=F.params.id,p=d(""),i=d(""),h=W(),_=d(!1),v=d(""),E=async()=>{var g,b,x;try{const l=await C.getPresentation(u);console.log("response",l),l.success?((g=l.presentation)!=null&&g.slides[0].slide_number?_.value=!0:_.value=!1,(b=l.presentation)!=null&&b.title?p.value=l.presentation.title:p.value="Presentation "+u,(x=l.presentation)!=null&&x.description?(console.log("response.presentation.description",l.presentation.description),i.value=l.presentation.description,console.log("presentationDescription",i.value)):i.value=""):v.value=l.error||"Failed to load presentation"}catch(l){v.value=T(l)}},$=()=>{h.push(`/presentations/${u}/slides/new`)},P=()=>{h.push(`/presentations/${u}/edit`)},m=()=>{console.log("Navigating to play presentation:",`/presentations/${u}/play`),console.log("Current route:",F.path),console.log("Presentation ID:",u),h.push(`/presentations/${u}/play`).catch(g=>{console.error("Navigation error:",g),v.value="Failed to navigate to presentation play mode"})};return z(E),(g,b)=>(r(),a("div",te,[c("div",se,[p.value?(r(),a("div",ne,f(p.value),1)):(r(),a("div",oe,"Your Presentation")),v.value?(r(),a("div",ie,f(v.value),1)):y("",!0)]),c("div",ae,[c("button",{onClick:$},"Add Slide"),c("button",{onClick:P},"Edit Presentation"),c("button",{disabled:!_.value,onClick:m,class:"play-button"}," Play Presentation ",8,re),i.value?(r(),a("div",le,f(i.value),1)):y("",!0)]),K(ee)]))}};export{pe as default};
